{% extends 'auth_base.html' %}

{% block title %}Parolni tiklash{% endblock title %}

{% block auth_content %}
<div class="login-logo mb-3">
  <b>TG Yuk</b> Monitor
</div>

<p class="login-box-msg">
  <i class="fas fa-key text-warning"></i> Parolni unutdingizmi?
</p>

<div class="alert alert-info alert-dismissible fade show">
  <i class="fas fa-info-circle"></i>
  <strong>Parolni tiklash:</strong><br>
  Telegram orqali tasdiqlangandan so'ng yangi parol o'rnatishingiz mumkin.
  <button type="button" class="close" data-dismiss="alert">&times;</button>
</div>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
      {{ message }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
  {% endfor %}
{% endif %}

<!-- Foydalanuvchi nomi kiritish -->
<form method="post" id="forgotForm">
  {% csrf_token %}

  <div class="input-group mb-3">
    <input 
      type="text" 
      name="username" 
      class="form-control" 
      placeholder="Login (foydalanuvchi nomi)" 
      required 
      autofocus
    >
    <div class="input-group-append">
      <div class="input-group-text">
        <span class="fas fa-user"></span>
      </div>
    </div>
  </div>

  <small class="form-text text-muted mb-3">
    <i class="fas fa-lightbulb"></i> 
    Ro'yxatdan o'tganingizdagi login nomini kiriting
  </small>

  <div class="row">
    <div class="col-12">
      <button type="submit" class="btn btn-warning btn-block" id="submitBtn">
        <i class="fas fa-unlock-alt"></i> Telegram orqali tiklash
      </button>
    </div>
  </div>
</form>

<hr class="my-3">

<!-- Orqaga qaytish -->
<div class="text-center">
  <a href="{% url 'login' %}" class="text-muted">
    <i class="fas fa-arrow-left"></i> Login sahifasiga qaytish
  </a>
</div>

<!-- Yordam -->
<div class="mt-4 p-3" style="background-color: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
  <p class="mb-2" style="font-size: 13px; color: #856404;">
    <i class="fas fa-exclamation-triangle"></i> <strong>Qanday ishlaydi?</strong>
  </p>
  <ol class="mb-0 pl-3" style="font-size: 12px; color: #856404;">
    <li>Login nomingizni kiriting</li>
    <li>Telegram orqali tasdiqlash kodi oling</li>
    <li>Kodni kiritganingizdan keyin yangi parol o'rnating</li>
  </ol>
</div>

<!-- Qo'shimcha yordam -->
<div class="mt-3 p-3" style="background-color: #f8f9fa; border-radius: 10px;">
  <p class="mb-2" style="font-size: 13px; color: #6c757d;">
    <i class="fas fa-question-circle text-info"></i> <strong>Login nomini unutdingizmi?</strong>
  </p>
  <p class="mb-0" style="font-size: 12px; color: #6c757d;">
    Agar login nomingizni ham eslay olmasangiz, administratorga murojaat qiling yoki
    <a href="{% url 'telegram_auth_phone' %}">Telegram orqali yangi akkaunt yarating</a>.
  </p>
</div>

{% endblock auth_content %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('forgotForm');
  const submitBtn = document.getElementById('submitBtn');
  const usernameInput = document.querySelector('input[name="username"]');

  // Username validatsiya - faqat harflar, raqamlar, _ va -
  usernameInput.addEventListener('input', function(e) {
    // Bo'shliqlarni olib tashlash
    this.value = this.value.trim().toLowerCase();
    
    // Faqat ruxsat etilgan belgilar
    this.value = this.value.replace(/[^a-z0-9_-]/g, '');
  });

  // Form submit
  form.addEventListener('submit', function(e) {
    const username = usernameInput.value.trim();
    
    // Validatsiya
    if (username.length < 3) {
      e.preventDefault();
      alert('Login nomi kamida 3 ta belgidan iborat bo\'lishi kerak!');
      usernameInput.focus();
      return;
    }

    if (username.length > 30) {
      e.preventDefault();
      alert('Login nomi juda uzun!');
      usernameInput.focus();
      return;
    }

    // Tasdiqlash
    const confirmed = confirm(
      'Login: ' + username + '\n\n' +
      'Ushbu login uchun parol tiklash jarayonini boshlaysizmi?\n\n' +
      'Telegram akkauntingizga tasdiqlash kodi yuboriladi.'
    );

    if (!confirmed) {
      e.preventDefault();
      return;
    }

    // Tugmani disable qilish
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tekshirilmoqda...';
  });

  // Enter bosilganda submit
  usernameInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      form.requestSubmit();
    }
  });
});
</script>

<style>
/* Warning button hover effect */
.btn-warning:hover {
  background-color: #e0a800 !important;
  border-color: #d39e00 !important;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
}

/* Username input focus */
input[name="username"]:focus {
  border-color: #ffc107;
  box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
}

/* Alert animatsiya */
.alert {
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
{% endblock extra_js %}
```

**Bu faylda nima bor:**

âœ… **Username kiritish** - login nomini so'raydi
âœ… **Telegram orqali tiklash** - Telegram auth ga yo'naltiradi
âœ… **Validatsiya** - username formatini tekshiradi
âœ… **Tasdiqlash dialog** - ishonch hosil qiladi
âœ… **Ko'rsatmalar** - jarayonni tushuntiradi
âœ… **Yordam bo'limi** - agar login nomini unutgan bo'lsa
âœ… **Warning dizayni** - sariq rang bilan muhimligini ko'rsatadi
âœ… **Auto-lowercase** - avtomatik kichik harfga o'tkazadi

**Qayerga joylashtirish:**
```
templates/
  â””â”€â”€ forgot_password.html  ðŸ‘ˆ Shu yerga