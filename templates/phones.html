{% extends 'app_base.html' %}

{% block page_title %}Telefonlar{% endblock page_title %}

{% block page_content %}
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Kanal telefonlari (unikal) â€” Kanal ID: {{ channel_id }}</h3>
  </div>
  <div class="card-body">
    <form method="get">
      <div class="form-row align-items-end">
        <div class="form-group col-md-3">
          <label>Boshlanish sanasi</label>
          <input type="date" name="date_from" value="{{ date_from }}" class="form-control">
        </div>
        <div class="form-group col-md-3">
          <label>Tugash sanasi</label>
          <input type="date" name="date_to" value="{{ date_to }}" class="form-control">
        </div>
        <div class="form-group col-md-6">
          <button type="submit" class="btn btn-primary mr-2">Filtrlash</button>
          <a class="btn btn-default mr-2" href="{% url 'channel_phones_excel' channel_id %}?date_from={{ date_from }}&date_to={{ date_to }}&search={{ request.GET.search }}">Excel</a>
          <a class="btn btn-default" href="{% url 'channel_stats' channel_id %}?date_from={{ date_from }}&date_to={{ date_to }}">Statistika</a>
        </div>
      </div>

      <!-- Search Input -->
      <div class="form-row mt-2">
        <div class="form-group col-md-6">
          <label>Qidirish</label>
          <div class="input-group">
            <input type="text" name="search" value="{{ request.GET.search }}" class="form-control" placeholder="Telefon raqam yoki ID bo'yicha qidirish...">
            <div class="input-group-append">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Qidirish
              </button>
            </div>
          </div>
        </div>
        {% if request.GET.search %}
        <div class="form-group col-md-6 d-flex align-items-end">
          <a href="{% url 'channel_phones' channel_id %}?date_from={{ date_from }}&date_to={{ date_to }}" class="btn btn-secondary">
            <i class="fas fa-times"></i> Filterni tozalash
          </a>
        </div>
        {% endif %}
      </div>
    </form>

    <div class="row">
      <div class="col-lg-6">
        <div class="card card-outline card-primary">
          <div class="card-header">
            <h3 class="card-title">Telefon</h3>
          </div>
          <div class="card-body table-responsive p-0">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Telefon</th>
                  <th>Xabarlar soni</th>
                </tr>
              </thead>
              <tbody>
              {% for item in phone_stats %}
                <tr>
                  <td>
                    <a href="{% url 'channel_phone_messages' channel_id %}?phone={{ item.phone }}&date_from={{ date_from }}&date_to={{ date_to }}">
                      {{ item.phone }}
                    </a>
                  </td>
                  <td>{{ item.total }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="2" class="text-muted">Telefon raqamlar topilmadi.</td></tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-outline card-secondary">
          <div class="card-header">
            <h3 class="card-title">ID / boshqa raqam</h3>
          </div>
          <div class="card-body table-responsive p-0">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Xabarlar soni</th>
                </tr>
              </thead>
              <tbody>
              {% if id_stats %}
                {% for item in id_stats %}
                  <tr>
                    <td>{{ item.phone }}</td>
                    <td>{{ item.total }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="2" class="text-muted">ID ko'rinishidagi raqamlar topilmadi.</td></tr>
              {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div>
      <a class="btn btn-default" href="{% url 'channels' %}"><i class="fas fa-arrow-left mr-1"></i>Kanallarga</a>
    </div>
  </div>
</div>
{% endblock page_content %}